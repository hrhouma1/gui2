

# 1) Sweatly — Description produit (exhaustive)

**Vision.** Aider l’utilisateur à s’entraîner régulièrement avec des séances adaptées, un suivi clair de sa progression, et un petit côté social (partage des réussites) — le tout **mobile-first, offline-first**.

**Cibles.** Débutants à intermédiaires; coachs qui publient des circuits; étudiants qui veulent une routine simple.

**Fonctionnalités cœur (MVP)**

* **Onboarding & Profil** : objectifs (perte de poids, force, mobilité), niveau, matériel disponible.
* **Bibliothèque d’exercices** : fiches normalisées (gif/image, muscles ciblés, consignes, variantes, contre-indications).
* **Séances & Programmes** : circuits (ex: 3×10, AMRAP, EMOM), timers, repos, alternatives par niveau.
* **Progression** : séries, répétitions, charges, temps; graphiques d’évolution par exercice/séance.
* **Favoris & Historique** : enregistrer des séances, rejouer un “workout du jour”.
* **Notifications** : rappels, relances de streak, reprise après inactivité.
* **Partage discret** : capture/résumé “workout complété” (sans données sensibles), optionnel.
* **Mode hors-ligne** : exécuter une séance sans réseau; synchro à la reconnexion.

**Fonctionnalités “+1” (post-MVP)**

* **Recommandations** (séances adaptées aux dernières perfs & fatigue auto-déclarée).
* **Plan hebdo automatique** (alternance haut/bas du corps, intensité).
* **Badges & Gamification** (streaks, records personnels).
* **Espace coach** (console web pour créer programmes).

---

## Parcours utilisateurs (Happy paths)

1. **Nouveau·elle** : crée un compte → répond à 4–6 questions d’onboarding → reçoit un **Plan de 7 jours** prêt à lancer → démarre “Séance 01”.
2. **Retour après pause** : l’app détecte >7 jours d’inactivité → propose une **séance de reprise** + rappel progressif des charges.
3. **Routine régulière** : ouvre l’app → “Workout du jour” en 1 tap → timer intégré → saisie ultra-rapide des perfs → feedback immédiat.
4. **Offline** : commute métro/salle → lance la séance en cache (médias + consignes locales) → synchro quand réseau revient.

---

## Modèle de données (Firestore + Storage)

Collections principales :

* `users/{uid}`
  `displayName, goal, level, equipment[], height, weight, lastActiveAt, streak, badges[]`
* `exercises/{exerciseId}`
  `title, muscles[], equipment[], level, mediaUrls{image, gif}, cues[], contraindications[]`
* `workouts/{workoutId}`
  `title, blocks[]` (chaque block = liste d’exercices avec schéma: sets/reps/timer/tempo/alternatives), `level`, `tags[]`
* `programs/{programId}`
  `title, weeks[], level, targetGoal, author`
* `sessions/{sessionId}` (journal)
  `userId, workoutId, performedAt, entries[]` (par exercice : `sets, reps/repsDone, weight, time, rpe`)
* `favorites/{userId}/items/{workoutId}`
* `metrics_daily/{userId}_{yyyyMMdd}`
  `completedCount, volumeTotalKg, durationMin, streakDay`

**Stockage (Cloud Storage)**

* `/exercises/{id}/media/*` (images/gifs courtes optimisées, webp/mp4)
* `/users/{uid}/share/*` (images de partage générées)

**Règles clé**

* Lecture publique **limitée** aux exercices/programmes **publiés**; tout le reste scoped par `uid`.
* Écritures critiques (streaks, badges, recalculs) via **Cloud Functions**.

---

## Pile technique (mobile & backend)

### Mobile (Flutter)

* **Architecture** :

  * State management : **Riverpod** (ou Bloc)
  * Navigation : **GoRouter**
  * Caching local : **Hive** (sessions à venir, fiches d’exercices consultées, dernier “workout du jour”)
  * Media : `cached_network_image`, pré-fetch des médias du prochain workout
* **UX séance** :

  * Timers intégrés (intra-exercice & repos)
  * Saisie perfs **ultra-rapide** (tap sliders, suggestions automatiques à partir de la dernière séance)
  * Haptics & TTS (consignes courtes) optionnels
* **Packages Flutter (MVP)**
  `firebase_core, firebase_auth, cloud_firestore, firebase_storage, cloud_functions, firebase_messaging, flutter_riverpod, go_router, hive, hive_flutter, cached_network_image, intl`

### Backend (Firebase)

* **Auth** : email/mot de passe + providers (Apple/Google)
* **Firestore** : documents/collections pour contenu & progression
* **Cloud Functions (Gen2, Node 20)** :

  * `onSessionWrite` : agrège volume/temps, met à jour `metrics_daily` & `streak`
  * `awardBadges` : décerne badges selon règles (ex: 7 jours d’affilée)
  * `recommendNextWorkout` : simple heuristique initiale (niveau + muscles sous-travaillés)
  * `generateShareImage` : génère image sociale (Cloud Run/Functions + canvas node) → URL signée
* **Cloud Messaging (FCM)** : rappels personnalisés (fenêtre préférée), relance post-inactivité
* **Cloud Storage** : médias optimisés; gestion d’URLs signées si contenus premium/privés
* **Analytics** : Firebase Analytics + events customs (`workout_started`, `set_logged`, `workout_completed`, `streak_incremented`)

### Sécurité & confidentialité

* Règles Firestore : accès **par utilisateur** à ses journaux; contenu public en lecture seule (exercices publiés).
* **Aucune donnée santé sensible** (type médical) sans consentement explicite.
* **Export/effacement compte** (GDPR-like) : endpoint/Function pour récupérer/supprimer données.

### Performances & offline

* Pré-chargement **J+1** : workout du lendemain + médias.
* Mise en cache Hive des fiches d’exercices récemment ouvertes.
* Stratégie **write-behind** : journal écrit localement, puis synchro Firestore (retry/backoff).
* Image & gif : variantes en 3 tailles; choisir dynamiquement selon réseau.

### Observabilité & QA

* Crash reporting : Firebase Crashlytics
* Traces essentielles (durée affichage écran séance, latence lecture médias)
* Feature flags via `remote_config` (activer badges, recommandations)

### CI/CD

* GitHub Actions ou Codemagic : build Android App Bundle + iOS (TestFlight)
* **Flavors** : dev / staging / prod (configs Firebase distinctes)
* Tests unitaires (logic perfs/reco), golden tests UI pour écrans clés

---

## Recommandation : quoi faire **en premier** (ordre priorisé)

### Semaine 0 — Préparation

1. **Création des projets Firebase** (dev, staging, prod) + activation Auth/Firestore/Storage/Functions/FCM.
2. **Skeleton Flutter** (flavors, GoRouter, Riverpod, thème, design tokens).
3. **Schéma Firestore** minimal + règles lecture publique des `exercises` publiés; tout le reste privé.

### Sprint 1 — **MVP séance hors-ligne**

1. **Onboarding court** (objectif, niveau, matériel) → stockage `users/{uid}`.
2. **Écran “Workout du jour”** (mock statique d’abord) avec **timer** et **saisie perfs**.
3. **Cache local (Hive)** pour le workout courant + médias pré-téléchargés.
4. **Journal simple** : écrire `sessions/{id}` (local→sync).
   **Sortie sprint** : on peut faire une séance **sans réseau**, la terminer, et la synchro se fait ensuite.

### Sprint 2 — **Bibliothèque & progression**

1. **Liste/fiche exercices** (Firestore + images Storage).
2. **Workouts dynamiques** depuis Firestore (fini le mock).
3. **Fonction Cloud `onSessionWrite`** : agrégation volume/temps + mise à jour `metrics_daily`, `streak`.
4. **Historique & favoris** (rejouer séance).

### Sprint 3 — **Notifications & qualité**

1. **FCM** : rappels personnalisés (créneau préféré).
2. **Relance post-inactivité** (J+3/J+7).
3. **Crashlytics + Analytics** : instrumentation des événements clés.
4. **Optim médias** : images/gifs en plusieurs tailles; pré-fetch J+1.

### Sprint 4 — **Recommandations & partage**

1. **`awardBadges`** (badges basiques : 3 séances/semaine, 7 jours d’affilée).
2. **`recommendNextWorkout`** (heuristique niveau + alternance muscles).
3. **Image de partage** (Function/Run) avec stats de la dernière séance.

> **Point d’attention** : ne complexifie pas la reco dès le départ. Commence par une heuristique transparente. Les modèles ML pourront venir **après** avoir collecté des journaux suffisants.

---

## Critères d’acceptation (MVP)

* L’utilisateur peut **créer un compte**, passer l’onboarding, lancer et terminer **une séance**.
* La séance fonctionne **sans réseau** (timer + saisie), puis **se synchronise** correctement.
* Son **historique** affiche la séance dans la journée, avec **volume total** et **durée**.
* Il reçoit un **rappel** le lendemain dans son créneau préféré.
* Aucune donnée autre que les exercices publiés n’est visible sans authentification.


